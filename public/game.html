<!DOCTYPE html>
<html>
    <head>
        <title>game</title>
        <meta charset="utf-8" />
        <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
        <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
        
        <script src="/socket.io/socket.io.js"></script>
        <script src="js/aframe-environment-component.min.js"></script>
        <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
        
    </head>

    <body>

        <a-scene>
            
            <a-entity camera wasd-controls look-controls position="0 1.404 4.337">
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>
            
            </a-entity>
            <a-entity light="type:Ambient; intensity:1; castShadow:false; shadowBias:-0.0005; angle:40; penumbra:0.3;" position="0.5 -0.5 0" rotation="0 0 0"></a-entity>
            <a-entity class="ground"  geometry="primitive:plane; width:14; height:14;" material="color:gray;" position="0 0.01 0" rotation="-90 0 0"></a-entity>
            <a-entity class="board"  geometry="primitive:plane; width:5; height:3;" material="color:white;" position="0 2 0" rotation="0 0 0"></a-entity>
            <!-- red button -->
            <a-entity id="redbutton1" position="2.036 0.926 0." >
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(	219, 202, 168)"
                animation__click="property:position.z; from:-.2; to:0; startEvents:click; dur:300" ></a-entity> 
            </a-entity>

            <a-entity id="redbutton2" position="2.036 1.8 0." >
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(	219, 202, 168)"
                animation__click="property:position.z; from:-.2; to:0; startEvents:click; dur:300" ></a-entity> 
            </a-entity>


            <a-entity id="bluebutton1" position="-2.036 0.926 0.">
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(	219, 202, 168)"
                animation__click="property:position.z; from:-.2; to:0; startEvents:click; dur:300"></a-entity>  
            </a-entity>

            <a-entity id="bluebutton2" position="-2.036 1.8 0.">
                <a-entity class="button interactive" position="0 0 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(	219, 202, 168)"
                animation__click="property:position.z; from:-.2; to:0; startEvents:click; dur:300"></a-entity>  
            </a-entity>

            <a-entity id="blueWinsText" visible="false" position="0 1.667 0">
                <a-text class="blueWinsMessage" value="Blue Wins!" color="blue" width="4" opacity="1"></a-text>
            </a-entity>

            <a-entity environment="preset:forest"></a-entity>
        </a-scene>

        <!-- this is magic code created when the node server runs -->
        <!-- putting at the bottom of body to let body load first before we try to query for elements -->
        <!-- //VERY HANDY! https://socket.io/docs/v4/emit-cheatsheet/ -->
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();

            let redButton1Clicked = false;
            let redButton2Clicked = false;
            let blueButton1Clicked = false;
            let blueButton2Clicked = false;


            socket.on('connect', (userData) => {
                console.log('I exist!');

            //listen to event from server
            document.querySelector('#redbutton1').querySelector('.button').addEventListener('click', function(){
                if (!redButton1Clicked) {
                socket.emit('red1');
                redButton1Clicked = true;
                }
            });

            document.querySelector('#redbutton2').querySelector('.button').addEventListener('click', function(){
                if (!redButton2Clicked) {
                socket.emit('red2');
                redButton2Clicked = true;
                }
            });

            document.querySelector('#bluebutton1').querySelector('.button').addEventListener('click', function(){
                if (!blueButton1Clicked) {    
                socket.emit('blue1');
                blueButton1Clicked = true;
                }
                });

             document.querySelector('#bluebutton2').querySelector('.button').addEventListener('click', function(){
                if (!blueButton2Clicked) {    
                socket.emit('blue2');
                blueButton2Clicked = true;
                }
                });    
            });

            

         if (!blueButton1Clicked) {  
        socket.on('color_change_blue1', (data) => {
           
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color_change_blue1:' + colorStr);
                document.querySelector('#bluebutton1').querySelector('.button').setAttribute('material', { color: colorStr });
          });}

    if (!blueButton2Clicked) {
            socket.on('color_change_blue2', (data) => {
        
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color_change_blue2:' + colorStr);
                document.querySelector('#bluebutton2').querySelector('.button').setAttribute('material', { color: colorStr });
         }); }

    if (!redButton1Clicked) {
        socket.on('color_change_red1', (data) => {
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color_change_red1:' + colorStr);
                document.querySelector('#redbutton1').querySelector('.button').setAttribute('material', { color: colorStr });
          });}

 if (!redButton2Clicked) {
        socket.on('color_change_red2', (data) => {
           
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color_change_red2:' + colorStr);
                document.querySelector('#redbutton2').querySelector('.button').setAttribute('material', { color: colorStr });
        }); }

        function checkBlueWins() {
            if (!blueButton1Clicked && !blueButton2Clicked) {
                document.querySelector('#blueWinsText').setAttribute('visible', 'true');
                console.log('blue wins');
                socket.emit('blueWins');
            }}
        socket.on('blueWins', () => {
        document.querySelector('#blueWinsText').setAttribute('visible', 'true');
        
        console.log('Blue');
        });
        </script>
    </body>
</html>
